<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>telefone</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/telefone.css">
    <link rel="shortcut icon" href="../assets/imagens/favicon.ico" type="image/x-icon">

</head>

<body>

    <!-- Início do telefone -->

    <div id="imagemFundo">
        <br><br><br><br><br><br><br><br><br><br>
        <div class="div_container3">
            <div class="div_telefone">

                <h1>Telefone</h1>

                <span>Para mais segurança Insira o seu telefone</span>

                <input id="telefone_input" placeholder="11966585483">

                <br><br>
                <div> <button onclick="proximo()">Próximo</button></div>
                <br>
                <a href="Site_Log/index.html"><span>Já registrei o meu telefone</span></a>
                <br>
            </div>
        </div>
        <br><br><br><br><br><br><br><br><br><br>
    </div>

    <!-- Fim do telefone -->

</body>
<script>

    // Início do script para cadastrar o telefone

    var idUsuario = undefined
    var telefoneInicial = undefined

    function proximo() {

        idUsuario = sessionStorage.ID_USUARIO;
        telefoneInicial = telefone_input.value


        cadastrar(idUsuario, telefoneInicial);

    }



    function cadastrar(fkUsuario, telefoneFinal) {


        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo


        if (fkUsuario == "" || telefoneFinal == ``) {

            console.log("Mensagem de erro para todos os campos em branco");


            return false;
        }


        // Enviando o valor da nova input
        fetch(`/telefone/cadastrar/${fkUsuario}/${telefoneFinal}`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },

        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {


                console.log("Cadastro realizado com sucesso! Redirecionando para tela de Login...");
                window.location = "../Site_Log/"

            }

        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);

        });

        return false;
    }

    // Fim do script para cadastrar o telefone

</script>

</html>